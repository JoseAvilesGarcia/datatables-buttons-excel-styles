!function(factory){"function"==typeof define&&define.amd?define(["jquery","datatables.net","datatables.net-buttons","datatables.net-buttons/js/buttons.html5.js"],function($){return factory($,window,document)}):"object"==typeof exports?module.exports=function(root,$){return root=root||window,$&&$.fn.dataTable||($=require("datatables.net")(root,$).$),$.fn.dataTable.Buttons||require("datatables.net-buttons")(root,$),$.fn.dataTable.Buttons.excelHtml5||require("datatables.net-buttons/js/buttons.html5.js")(root,$),factory($,0,root.document)}:factory(jQuery,window,document)}(function($,window,document,undefined){var DataTable=$.fn.dataTable;DataTable.ext.buttons.excelHtml5.customize=function(xlsx){this.applyStyles(xlsx)},DataTable.ext.buttons.excelHtml5.applyStyles=function(xlsx){this._applyExcelStyles(xlsx)};function _parseExcellyReference(cells,sheet,smartRowOption){var matches=/^(s)*(?:-(\d*)(?=\>))*([A-Z]*|[>])*([tmhfb]{1})*(-(?=[0-9]+))*([0-9]*)(?:(\:)(?:-(\d*)(?=\>))*([A-Z]*|[>])*([tmhfb]{1})*(-(?=[0-9]+))*([0-9]*)(?:n([0-9]*)(?:,)*([0-9]*))*)*$/.exec(cells);if(null===matches)return!1;function _smartRow(index){return parseInt(index)+_rowRefs.dt-1}var tempCol,tempRow,results={smartRow:matches[1],fromColEndSubtractAmount:matches[2],fromCol:matches[3],fromSmartRow:matches[4],fromRowEndSubtract:matches[5],fromRow:matches[6],range:matches[7],toColEndSubtractAmount:matches[8],toCol:matches[9],toSmartRow:matches[10],toRowEndSubtract:matches[11],toRow:matches[12],nthCol:matches[13],nthRow:matches[14],pattern:cells};return!!function(results,smartRowOption){if(!(smartRowOption||results.smartRow&&"s"==results.smartRow))return results.smartRow=!1,1;results.smartRow=!0,results.fromRow&&!results.fromRowEndSubtract&&(results.fromRow=_smartRow(results.fromRow)),results.toRow&&!results.toRowEndSubtract&&(results.toRow=_smartRow(results.toRow));var match,pattern=/['tmhfb']{1}/;if(results.fromSmartRow!==undefined){if(!(match=pattern.exec(results.fromSmartRow))||!1===_rowRefs[match[0]])return;results.fromRow=_rowRefs[match[0]]}if(results.toSmartRow!==undefined){if(!(match=pattern.exec(results.toSmartRow))||!1===_rowRefs[match[0]])return;results.toRow=_rowRefs[match[0]]}return 1}(results,smartRowOption)&&(results.toCol=(results.toCol?results.toColEndSubtractAmount?_getMaxColumnIndex(sheet)-results.toColEndSubtractAmount:results.toCol:null)||(results.range||!results.fromCol?_getMaxColumnIndex(sheet):results.fromColEndSubtractAmount?_getMaxColumnIndex(sheet)-results.fromColEndSubtractAmount:results.fromCol),results.toCol=_parseColumnName(results.toCol,sheet),results.fromCol=results.fromCol?results.fromColEndSubtractAmount?_getMaxColumnIndex(sheet)-results.fromColEndSubtractAmount:results.fromCol:1,results.fromCol=_parseColumnName(results.fromCol,sheet),results.nthCol=results.nthCol?parseInt(results.nthCol):1,results.fromCol>results.toCol&&(tempCol=results.fromCol,results.fromCol=results.toCol,results.toCol=tempCol),results.toRow=(results.toRow?results.toRowEndSubtract?_getMaxRow(sheet,results)-results.toRow:results.toRow:null)||(results.range||!results.fromRow?_getMaxRow(sheet,results):results.fromRowEndSubtract?_getMaxRow(sheet,results)-results.fromRow:results.fromRow),results.toRow=parseInt(results.toRow),results.fromRow=results.fromRow?parseInt(results.fromRowEndSubtract?_getMaxRow(sheet,results)-results.fromRow:results.fromRow):_getMinRow(results),results.nthRow=results.nthRow?parseInt(results.nthRow):1,results.fromRow>results.toRow&&(tempRow=results.fromRow,results.fromRow=results.toRow,results.toRow=tempRow),results)}var _getMaxRow=function(sheet,results){return results.smartRow?_rowRefs.db:_getMaxSheetRow(sheet)},_getMinRow=function(results){return results.smartRow?_rowRefs.dt:1},_getMaxSheetRow=function(sheet){return Number($("sheetData row",sheet).last().attr("r"))},_getMaxColumnIndex=function(sheet){var maxColumn=0;return $("cols col",sheet).each(function(){var colMax=$(this).attr("max");maxColumn<colMax&&(maxColumn=colMax)}),Number(maxColumn)},_parseColumnName=function(columnName,sheet){if("number"==typeof columnName)return columnName;if(">"==columnName)return _getMaxColumnIndex(sheet);for(var alpha="ABCDEFGHIJKLMNOPQRSTUVWXYZ",result=0,i=0,j=columnName.length-1;i<columnName.length;i+=1,--j)result+=Math.pow(alpha.length,j)*(alpha.indexOf(columnName[i])+1);return Number(result)},_parseColumnIndex=function(index){--index;var letter=String.fromCharCode(65+index%26),nextNumber=parseInt(index/26);return 0<nextNumber?_parseColumnIndex(nextNumber)+letter:letter},_rowRefs={t:!1,m:!1,h:!1,dt:!1,db:!1,f:!1,b:!1};DataTable.ext.buttons.excelHtml5._applyExcelStyles=function(xlsx){var excelStyles=this.excelStyles||this.exportOptions.excelStyles;if(excelStyles!==undefined){Array.isArray(excelStyles)||(excelStyles=[excelStyles]);var sheet=xlsx.xl.worksheets["sheet1.xml"],config=DataTable.Api().buttons.exportInfo(this);for(var i in config.header=this.header,config.footer=this.footer,function(config,sheet){var currentRow=1;"string"==typeof config.title&&""!==config.title&&(_rowRefs.t=currentRow,currentRow++),null!==config.messageTop&&""!==config.messageTop&&(_rowRefs.m=currentRow,currentRow++),!1!==config.header&&(_rowRefs.h=currentRow,currentRow++),_rowRefs.dt=currentRow,currentRow=_getMaxSheetRow(sheet),null!==config.messageBottom&&""!==config.messageBottom&&(_rowRefs.b=currentRow,currentRow--),!1!==config.footer&&(_rowRefs.f=currentRow,currentRow--),_rowRefs.db=currentRow}(config,sheet),excelStyles){var style=excelStyles[i],styleLookup={},applyTable={},styleId=!1;style.index!==undefined&&"number"==typeof style.index&&(styleId=style.index);var cells=style.cells!==undefined?style.cells:["1:"];Array.isArray(cells)||(cells=[cells]);var smartRowRef=!1;for(var i in style.rowref&&"smart"==style.rowref&&(smartRowRef=!0),cells){var selection=_parseExcellyReference(cells[i],sheet,smartRowRef);if(!1!==selection){for(var col=selection.fromCol;col<=selection.toCol;col+=selection.nthCol){for(var colLetter=_parseColumnIndex(col),row=selection.fromRow;row<=selection.toRow;row+=selection.nthRow){var mergeWithCellStyle,newStyleId,tag='row[r="'+row+'"] c[r="'+colLetter+row+'"]',currentCellStyle=$(tag,sheet).attr("s")||0;styleLookup[currentCellStyle]==undefined&&(newStyleId=0===currentCellStyle&&styleId?styleId:(mergeWithCellStyle=style.merge===undefined||style.merge?currentCellStyle:0,_addXMLStyle(xlsx,styleId||style,mergeWithCellStyle)),styleLookup[currentCellStyle]=newStyleId,applyTable[styleLookup[currentCellStyle]]=[]),applyTable[styleLookup[currentCellStyle]].push(tag)}$('col[min="'+col+'"]',sheet).attr("width",style.width).attr("customWidth",!0)}for(row=selection.fromRow;row<=selection.toRow;row+=selection.nthRow)style.height!==undefined&&$('row[r="'+row+'"]',sheet).attr("ht",style.height).attr("customHeight",!0)}}for(var i in applyTable)$(applyTable[i].join(),sheet).attr("s",i)}}};function _findNodeValue(keyArray){var val=_translateAttributes;for(var i in keyArray)if(null!==keyArray[i]){if(val[keyArray[i]]===undefined)return undefined;val=val[keyArray[i]]}return val}function _mergeDefault(parentTagName,tagName,obj){var mergeObj=_findNodeValue([parentTagName,tagName,"default"]);return mergeObj!==undefined?$.extend({},mergeObj,obj):obj}function _getTranslatedKey(parentTagName,tagName){var newKey=_findNodeValue([parentTagName,"translate",tagName]);return newKey!==undefined?newKey:tagName}function _addXMLAttribute(tagName,attributeName,value,parentNode){var txAttr;if("object"==typeof value)for(var i in value=_mergeDefault(tagName,attributeName,value)){var key=_getTranslatedKey(tagName,i);!function(parentTagName,tagName,attributeName){return"child"==_findNodeValue([parentTagName,tagName,attributeName])}(tagName,attributeName,key)?$(parentNode).attr(key,value[i]):_addXMLNode(tagName,key,value[i],parentNode)}else""!=value&&(txAttr=function(parentTagName,tagName,attributeName,value){var tKey=_findNodeValue([parentTagName,tagName,attributeName]);tKey!==undefined&&"val"==attributeName&&(tKey=_findNodeValue([parentTagName,tagName,attributeName=tKey])),tKey!==undefined&&tKey.tidy!==undefined&&(value=tKey.tidy(value));var obj={};return obj[attributeName]=value,obj}(tagName,attributeName,"val",value),$(parentNode).attr(txAttr))}var _xmlStyleDoc,_translateAttributes={font:{translate:{size:"sz",strong:"b"},color:{val:"rgb",rgb:{tidy:function(val){return/([A-F0-9]{3,6})/.exec(val)[1].toUpperCase()}}}},fill:{translate:{pattern:"patternFill",type:"patternType",color:"fgColor"},fgColor:{val:"rgb"},bgColor:{val:"rgb"},patternFill:{default:{patternType:"",fgColor:"",bgColor:""},fgColor:"child",bgColor:"child"}},border:{default:{left:"",right:"",top:"",bottom:"",diagonal:""},color:{val:"rgb"},top:{val:"style",color:"child"},bottom:{val:"style",color:"child"},left:{val:"style",color:"child"},right:{val:"style",color:"child"}}},_addXMLNode=function(tagName,attributeName,value,parentNode){var attributeName=_getTranslatedKey(tagName,attributeName),childNode=0===parentNode.getElementsByTagName(attributeName).length?parentNode.appendChild(_xmlStyleDoc.createElement(attributeName)):parentNode.getElementsByTagName(attributeName)[0];_addXMLAttribute(tagName,attributeName,value,childNode)},_addXMLStyle=function(xlsx,addStyle,currentCellStyle){return"object"==typeof addStyle&&addStyle.style===undefined?currentCellStyle:(_xmlStyleDoc=xlsx.xl["styles.xml"],("object"==typeof addStyle?_mergeWithStyle:_mergeWithBuiltin)(addStyle,currentCellStyle))},_mergeWithBuiltin=function(builtInIndex,currentCellStyle){for(var cellXfs=_xmlStyleDoc.getElementsByTagName("cellXfs")[0],currentStyleXf=cellXfs.getElementsByTagName("xf")[currentCellStyle],mergeStyleXf=cellXfs.getElementsByTagName("xf")[builtInIndex],xf=cellXfs.appendChild(currentStyleXf.cloneNode(!0)),types=["font","fill","border","numFmt"],i=0;i<types.length;i++){var id=types[i]+"Id";if(mergeStyleXf.hasAttribute(id)&&xf.hasAttribute(id)){var mergeId=mergeStyleXf.getAttribute(id),typeId=xf.getAttribute(id),parentNode=_xmlStyleDoc.getElementsByTagName(types[i]+"s")[0],mergeNode=parentNode.childNodes[mergeId];if(mergeId!=typeId)if("numFmtId"==id)0<mergeId&&xf.setAttribute(id,mergeId);else{var childNode=parentNode.childNodes[typeId].cloneNode(!0);parentNode.appendChild(childNode),_updateContainerCount(parentNode),xf.setAttribute(id,parentNode.childNodes.length-1);for(var mergeNodeChildren=mergeNode.childNodes,key=0;key<mergeNodeChildren.length;key++){var newAttr=mergeNodeChildren[key].cloneNode(!0),attr=childNode.getElementsByTagName(mergeNodeChildren[key].nodeName);attr[0]?childNode.replaceChild(newAttr,attr[0]):childNode.appendChild(newAttr)}}}}return cellXfs.childNodes.length-1},_mergeWithStyle=function(addStyle,currentCellStyle){var cellXfs=_xmlStyleDoc.getElementsByTagName("cellXfs")[0],style=addStyle.style,existingStyleXf=cellXfs.getElementsByTagName("xf")[currentCellStyle],xf=cellXfs.appendChild(existingStyleXf.cloneNode(!0));for(var type in style){var lastId,numFmtId,existingTypeId,node,typeNode=_xmlStyleDoc.getElementsByTagName(type+"s")[0],styleId=type+"Id";if("alignment"!=type)if("numFmt"==type){"number"==typeof style[type]?xf.setAttribute(styleId,style[type]):((node=_xmlStyleDoc.createElement(type)).setAttribute("formatCode",style[type]),lastId=typeNode.lastChild.getAttribute("numFmtId"),numFmtId=Number(lastId)+1,node.setAttribute("numFmtId",numFmtId),typeNode.appendChild(node),_updateContainerCount(typeNode),xf.setAttribute(styleId,numFmtId))}else{for(var attr in node=xf.hasAttribute(styleId)?(existingTypeId=xf.getAttribute(styleId),typeNode.childNodes[existingTypeId].cloneNode(!0)):_xmlStyleDoc.createElement(type),typeNode.appendChild(node),style[type]=_mergeDefault(type,null,style[type]),style[type]){var value=style[type][attr];_addXMLNode(type,attr,value,node)}xf.setAttribute(styleId,typeNode.childNodes.length-1),_updateContainerCount(typeNode)}}return style.alignment!==undefined&&(_addXMLNode("xf","alignment",style.alignment,xf),xf.setAttribute("applyAlignment","1")),_updateContainerCount(cellXfs),cellXfs.childNodes.length-1},_updateContainerCount=function(container){container.setAttribute("count",container.childNodes.length)};return DataTable.Buttons});